<input type="file" (change)="onFileChanged($event)" style="display:none;" #fileInput />

<app-popover>
  <div header>
    <h1 *ngIf="!recipeToEdit; else editRecipe" style="margin-bottom: 0;">Add Recipe</h1>
    <ng-template #editRecipe>
      <h1 style="margin-bottom: 0;">EDIT {{recipeToEdit.title}}</h1>
    </ng-template>
  </div>

  <div body>
    <form [formGroup]="recipeForm" *ngIf="recipeForm">
      <input type="text" formControlName="title" class="form-control" placeholder="Recipe Title" />
      <textarea type="text" formControlName="description" class="form-control"
        placeholder="Recipe Description"></textarea>

      <h4>Image</h4>
      <button class="btn btn-light" (click)="fileInput.click()">
        Select Image
      </button>
      <div *ngIf="uploadedImage" class="image recipe-section"
        [ngStyle]="{ 'background-image': 'url(' + uploadedImage + ')' }"
        style="height: 250px; background-position: center; background-size: cover;"></div>
      <div class="d-flex section-heading">
        <h4>Ingredients</h4>
      </div>
      <ng-container formArrayName="ingredients" *ngFor="
          let ingredient of recipeForm.get('ingredients')['controls'];
          let i = index
        ">
        <div [formGroupName]="i" class="d-flex">
          <div>
            <button class="btn btn-light mr-2" (click)="removeIngredient(i)">
              <fa-icon icon="times"></fa-icon>
            </button>
          </div>
          <select class="form-control ingredient-input" formControlName="ingredientId">
            <option *ngFor="let ingredient of ingredientList" [ngValue]="ingredient.id">
              {{ ingredient.name }}</option>
          </select>


          <input type="number" formControlName="quantity" placeholder="Quantity" class="form-control ml-2 quantity" />
          <select *ngIf="checkIfIngredient(i)" class="form-control ml-2 ingredient-input" formControlName="unitId">
            <option *ngFor="let unit of unitList | filter:'unit_type': getSelectedIngredientUnitType(i)"
              [ngValue]="unit.id">
              {{ unit.name }}</option>
          </select>
          <input type="text" formControlName="notes" placeholder="Notes" class="form-control ml-2 ingredient-input" />


          <!-- <button class="btn btn-success ml-2" (click)='checkIfIngredient(i)'>Print</button> -->


        </div>
      </ng-container>
      <button class="btn btn-light" (click)="addIngredient()">
        Add
      </button>
      <div class="d-flex section-heading">
        <h4>Steps</h4>
      </div>
      <ng-container formArrayName="steps" *ngFor="let steps of recipeForm.get('steps')['controls']; let i = index">
        <div [formGroupName]="i" class="d-flex">
          <div>
            <button class="btn btn-light mr-2" (click)="removeStep(i)">
              <fa-icon icon="times"></fa-icon>
            </button>
          </div>
          <textarea type="text" formControlName="instruction" placeholder="Instructions"
            class="form-control"></textarea>
        </div>
      </ng-container>
      <button class="btn btn-light" (click)="addStep()">
        Add
      </button>
      <div>
        <button class="btn btn-success" (click)="submit()">Submit</button>
      </div>

    </form>
  </div>
</app-popover>